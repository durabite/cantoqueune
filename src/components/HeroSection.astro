---
import { Play, Pause } from "lucide-react";
---

<section id="inicio" class="hero">
    <div class="hero-video-bg">
        <video src="/BG-Hero.mp4" autoplay loop muted playsinline></video>
    </div>
    <div class="hero-overlay"></div>
    <div class="container hero-content">
        <img
            src="/logo-cantoqueuneG.svg"
            alt="Canto Que Une"
            class="hero-logo"
        />

        <h1 class="main-title">
            <span class="block text-4xl font-light mb-2.5 font-sans"
                >POR PRIMERA VEZ EN MÉXICO</span
            >
            Indios Beta
        </h1>

        <div class="hero-buttons">
            <a href="#fechas" class="btn btn-primary">Boletos</a>
            <a href="#conocenos" class="btn btn-secondary">Saber más</a>
        </div>
    </div>

    <!-- Audio Player Button -->
    <div
        class="absolute bottom-10 right-10 z-20 flex flex-col items-center gap-2"
    >
        <audio id="hero-audio" src="/musica-indiosbeta.mp3" loop autoplay
        ></audio>

        <button
            id="audio-control"
            class="bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-full text-white hover:bg-white/20 hover:scale-110 transition-all duration-300 group shadow-lg shadow-primary/20"
            aria-label="Reproducir música"
        >
            <!-- Icons only inside the button -->
            <div
                id="icon-play"
                class="hidden group-hover:text-primary transition-colors"
            >
                <Play className="w-6 h-6 fill-current" />
            </div>
            <div
                id="icon-pause"
                class="block group-hover:text-primary transition-colors"
            >
                <Pause className="w-6 h-6 fill-current" />
            </div>
        </button>

        <!-- Text labels outside the button -->
        <span
            id="text-play"
            class="hidden text-[10px] uppercase font-bold text-white tracking-widest"
            >Play</span
        >
        <span
            id="text-pause"
            class="block text-[10px] uppercase font-bold text-white tracking-widest"
            >Pause</span
        >
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const audio = document.getElementById("hero-audio") as HTMLAudioElement;
        const btn = document.getElementById("audio-control");

        const playIcon = document.getElementById("icon-play");
        const pauseIcon = document.getElementById("icon-pause");

        const playText = document.getElementById("text-play");
        const pauseText = document.getElementById("text-pause");

        if (audio && btn && playIcon && pauseIcon && playText && pauseText) {
            const updateUI = (isPlaying: boolean) => {
                if (isPlaying) {
                    // Show Pause UI (Audio is Playing)
                    playIcon.classList.remove("block");
                    playIcon.classList.add("hidden");
                    playText.classList.remove("block");
                    playText.classList.add("hidden");

                    pauseIcon.classList.remove("hidden");
                    pauseIcon.classList.add("block");
                    pauseText.classList.remove("hidden");
                    pauseText.classList.add("block");

                    btn.classList.add("ring-2", "ring-primary/50");
                } else {
                    // Show Play UI (Audio is Paused)
                    playIcon.classList.remove("hidden");
                    playIcon.classList.add("block");
                    playText.classList.remove("hidden");
                    playText.classList.add("block");

                    pauseIcon.classList.remove("block");
                    pauseIcon.classList.add("hidden");
                    pauseText.classList.remove("block");
                    pauseText.classList.add("hidden");

                    btn.classList.remove("ring-2", "ring-primary/50");
                }
            };

            const tryPlayAudio = () => {
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log("Autoplay success");
                            updateUI(true);
                        })
                        .catch((error) => {
                            console.log("Autoplay prevented:", error);
                            updateUI(false);

                            // Fallback: Play on first interaction
                            const unlockAudio = () => {
                                audio
                                    .play()
                                    .then(() => {
                                        updateUI(true);
                                        document.removeEventListener(
                                            "click",
                                            unlockAudio,
                                        );
                                        document.removeEventListener(
                                            "keydown",
                                            unlockAudio,
                                        );
                                    })
                                    .catch((e) =>
                                        console.error("Still blocked", e),
                                    );
                            };

                            document.addEventListener("click", unlockAudio);
                            document.addEventListener("keydown", unlockAudio);
                        });
                }
            };

            // Attempt Play immediately
            tryPlayAudio();

            // Click Handler for Button
            btn.addEventListener("click", (e) => {
                // Prevent the document listener from firing immediately if it's still attached
                e.stopPropagation();

                if (audio.paused) {
                    audio.play();
                    updateUI(true);
                } else {
                    audio.pause();
                    updateUI(false);
                }
            });
        }
    });
</script>

<style>
    /* Hero Section Styles moved from global.css */
    .hero {
        height: 100vh;
        width: 100%;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background-color: var(--bg-dark);
        overflow: hidden;
    }

    .hero-video-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
    }

    .hero-video-bg video {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: translate(-50%, -50%);
        opacity: 0.8;
    }

    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            to bottom,
            rgba(5, 5, 16, 0.2),
            var(--bg-dark)
        );
        z-index: 1;
    }

    .hero-content {
        position: relative;
        z-index: 2;
        padding-top: 30px;
    }

    .hero-logo {
        max-width: 270px;
        margin: 0 auto 30px;
        filter: drop-shadow(0 0 10px rgba(176, 0, 176, 0.5));
    }

    .main-title {
        font-size: 4rem;
        line-height: 1.1;
        margin-bottom: 40px;
        text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .hero-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .main-title {
            font-size: 2.5rem;
        }
    }
</style>
